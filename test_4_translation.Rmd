---
title: "test for translation"
author: "wwqi4realGitHub"
date: "4/4/2020"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```


# function module

*before you run test on the code below, make sure you have all the files in correct paths*

*if edit, make sure you update the changes to Daily Report.R*

```{r}
translate_country = function(ut_data) {
  
  # wwqi4realGitHub Apr 4
  # ut_data: untranslated data frame, which is used for plots/tables
  # for the table part, Hubei translation is now supported
  # csv file is modified to support different country names (mainly for table 1 input)
  
  # support data input of 
  # plot: 2,3 (tho ggplot doesnt support Chinses char well)
  # table: 1,2,3
  
  
  
  # read in the CN-EN data
  cn_name = read_csv("./translation/world_cn.csv")
  en_name = read_csv("./translation/world_en.csv")
  
  # combine the two name dataframes
  # trans_name = cbind(cn_name, en_name)
  
  trans_name = full_join(cn_name, en_name, by = "id") %>% 
  janitor::clean_names() %>% 
  select(name_x, name_y) %>% 
  rename(Country_cn = name_x, 
         Country = name_y) %>% 
  unite("Country_bi", Country_cn:Country, sep = " ", remove = F)
  
  t_data = left_join(ut_data, trans_name, by = "Country") %>% 
    # in this step coercing warning will show up but dont worry
    mutate(Country =  as.factor(as.character(Country)), 
           Country_cn = as.factor(as.character(Country_cn)), 
           Country_bi = as.factor(as.character(Country_bi)))
  
  print("[Just if] Ignore the [coercing] warning, already taken care of")
  return(t_data)
}
```

```{r}
translate_state = function(ut_data) {
  
  # wwqi4realGitHub Apr 5
  # ut_data: untranslated data frame, which is used for plots/tables
  
  # support data input of 
  # plot: 
  # table: 4,5,7
  
  state_cn = read_csv("./translation/state_translate.txt") %>% 
    rename(state = State_Full) %>% 
    janitor::clean_names()
  
  t_data = left_join(ut_data, state_cn, by = "state") %>% 
  select(state_cn, state, everything()) %>% 
  unite("state_bi", state_cn, state_abb, sep = " ", remove = F)
  
}
```

```{r}
translate_table6 = function(ut_data) {
  
  # wwqi4realGitHub Apr 5
  # ut_data: untranslated data frame, which is used for plots/tables
  
  # support data input of 
  # plot: 
  # table: 6
  
  state_cn = read_csv("./translation/state_translate.txt") %>% 
    janitor::clean_names() %>% 
    rename(state = state_abb)
  
  t_data = left_join(ut_data, state_cn, by = "state") %>% 
  select(state_cn, state, everything()) %>% 
  unite("state_bi", state_cn, state, sep = " ", remove = F)
  
}
```


# test module

### global countries and regions

the data below is from Daily Report.R 

To test, pls first run the R script to make sure the data is in Environment

```{r}
# Apr 4: pass for plot 2 and 3 data
pt2 = data_to_plot_confirmed %>% translate_country()

pt3 = data_to_plot_confirmed_increment %>% translate_country()
```

note0404: that table 1 use region as the 'country' name; considering use a different function
update0405: change the name in table 1 code, ignore note0403

```{r}
# 0404: pass for table 1
# 0405: no NA now, all check
tt1 = crude_incidence_rate %>% translate_country()
```

```{r}
# 0405 pass for table 2
tt2 = data_global_latest_confirmed %>% rename("Country" = "Country/Region") %>% translate_country()
```

```{r}
# 0405 pass for table 3
tt3 = data_global_latest_death %>% rename("Country" = "Country/Region") %>% translate_country()
```

### US states 

```{r}
# 0405 pass for table 4
tt4 = data_us_latest_confirm %>% translate_state()
```

```{r}
# 0405 pass for table 5
tt5 = data_us_latest_incremental %>% translate_state()
```

```{r}
# 0405 pass for table 7
tt7 = data_us_latest_fatality %>% translate_state()
```

```{r}
# table 6 use different input, therefore use a separate function
# 0405 pass for table 6
tt6 = data_us_positive_rate_avg %>% translate_table6()
```


---

